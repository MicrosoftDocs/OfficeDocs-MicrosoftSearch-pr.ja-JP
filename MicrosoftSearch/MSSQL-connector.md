---
title: Microsoft Search 用 microsoft SQL server および Azure SQL connector
ms.author: mounika.narayanan
author: monaray
manager: mnirkhe
ms.audience: Admin
ms.topic: article
ms.service: mssearch
localization_priority: Normal
search.appverid:
- BFB160
- MET150
- MOE150
description: Microsoft Search 用の Microsoft SQL server または Azure SQL connector をセットアップします。
ms.openlocfilehash: 55c2e86697d2159bf93bc950c47a37630739dba9
ms.sourcegitcommit: dd082bf862414604e32d1a768e7c155c2d757f51
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/13/2020
ms.locfileid: "46657015"
---
# <a name="azure-sql-and-microsoft-sql-server-connectors"></a><span data-ttu-id="e9265-103">Azure SQL および Microsoft SQL server コネクタ</span><span class="sxs-lookup"><span data-stu-id="e9265-103">Azure SQL and Microsoft SQL server connectors</span></span>

<span data-ttu-id="e9265-104">Microsoft SQL server または Azure SQL コネクタを使用すると、組織は、オンプレミスの SQL Server データベースまたはクラウド内の Azure SQL インスタンスでホストされているデータベースのデータを検出し、インデックスを作成できます。</span><span class="sxs-lookup"><span data-stu-id="e9265-104">With a Microsoft SQL server or Azure SQL connector, your organization can discover and index data from an on-premises SQL Server database or a database hosted in your Azure SQL instance in the cloud.</span></span> <span data-ttu-id="e9265-105">コネクタは、指定されたコンテンツを Microsoft Search にインデックス付けします。</span><span class="sxs-lookup"><span data-stu-id="e9265-105">The connector indexes specified content into Microsoft Search.</span></span> <span data-ttu-id="e9265-106">ソースデータのインデックスを最新の状態に保つために、フルクロールと増分クロールを定期的に行います。</span><span class="sxs-lookup"><span data-stu-id="e9265-106">To keep the index up to date with source data, it supports periodic full and incremental crawls.</span></span> <span data-ttu-id="e9265-107">これらの SQL コネクタを使用すると、特定のユーザーに対する検索結果へのアクセスを制限することもできます。</span><span class="sxs-lookup"><span data-stu-id="e9265-107">With these SQL connectors, you can also restrict access to search results for certain users.</span></span>

<span data-ttu-id="e9265-108">この記事は、Microsoft 365 管理者または Microsoft SQL server または Azure SQL コネクタを構成、実行、および監視するユーザーを対象としています。</span><span class="sxs-lookup"><span data-stu-id="e9265-108">This article is for Microsoft 365 administrators or anyone who configures, runs, and monitors a Microsoft SQL server or Azure SQL connector.</span></span> <span data-ttu-id="e9265-109">コネクタとコネクタの機能、制限事項、およびトラブルシューティングの手法を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e9265-109">It explains how to configure your connector and connector capabilities, limitations, and troubleshooting techniques.</span></span> 

## <a name="install-a-data-gateway-required-for-on-premises-microsoft-sql-server-connector-only"></a><span data-ttu-id="e9265-110">Data gateway をインストールする (オンプレミスの Microsoft SQL server コネクタにのみ必要)</span><span class="sxs-lookup"><span data-stu-id="e9265-110">Install a data gateway (required for on-premises Microsoft SQL server connector only)</span></span>
<span data-ttu-id="e9265-111">サードパーティのデータにアクセスするためには、Microsoft Power BI ゲートウェイをインストールして構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-111">In order to access your third-party data, you must install and configure a Microsoft Power BI gateway.</span></span> <span data-ttu-id="e9265-112">詳細について[は、「オンプレミスゲートウェイをインストール](https://docs.microsoft.com/data-integration/gateway/service-gateway-install)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e9265-112">See [Install an on-premises gateway](https://docs.microsoft.com/data-integration/gateway/service-gateway-install) to learn more.</span></span>  

## <a name="register-an-app"></a><span data-ttu-id="e9265-113">アプリを登録します</span><span class="sxs-lookup"><span data-stu-id="e9265-113">Register an app</span></span>
<span data-ttu-id="e9265-114">Azure SQL connector の場合、Microsoft Search アプリがインデックス作成のためにデータにアクセスできるようにするには、Azure Active Directory にアプリを登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-114">For Azure SQL connector, you must register an app in Azure Active Directory to allow Microsoft Search app to access data for indexing.</span></span> <span data-ttu-id="e9265-115">アプリの登録の詳細については、Microsoft Graph のドキュメントを参照して[アプリを登録](https://docs.microsoft.com/graph/auth-register-app-v2)する方法を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e9265-115">To learn more about registering an app, refer Microsoft Graph documentation on how to [register an app](https://docs.microsoft.com/graph/auth-register-app-v2).</span></span> 

<span data-ttu-id="e9265-116">アプリの登録を完了し、アプリ名、アプリケーション (クライアント) ID、およびテナント ID をメモしておき、[新しいクライアントシークレットを生成](https://docs.microsoft.com/azure/healthcare-apis/register-confidential-azure-ad-client-app#application-secret)する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-116">After completing the app registration and taking note of the app name, application (client) ID and tenant ID, you need to [generate a new client secret](https://docs.microsoft.com/azure/healthcare-apis/register-confidential-azure-ad-client-app#application-secret).</span></span> <span data-ttu-id="e9265-117">クライアントシークレットは一度だけ表示されます。</span><span class="sxs-lookup"><span data-stu-id="e9265-117">The client secret will only be displayed once.</span></span> <span data-ttu-id="e9265-118">クライアントシークレットは安全に保存 & ことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e9265-118">Remember to note & store the client secret securely.</span></span> <span data-ttu-id="e9265-119">Microsoft Search で新しい接続を構成する際に、クライアント ID とクライアントシークレットを使用します。</span><span class="sxs-lookup"><span data-stu-id="e9265-119">Use the client ID and client secret while configuring a new connection in Microsoft Search.</span></span> 

<span data-ttu-id="e9265-120">登録済みのアプリを Azure SQL データベースに追加するには、次のことを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-120">To add the registered app to your Azure SQL Database, you need to:</span></span>
 - <span data-ttu-id="e9265-121">Azure SQL DB にログインします。</span><span class="sxs-lookup"><span data-stu-id="e9265-121">Log in to your Azure SQL DB</span></span>
 - <span data-ttu-id="e9265-122">新しいクエリウィンドウを開く</span><span class="sxs-lookup"><span data-stu-id="e9265-122">Open a new query window</span></span>
 - <span data-ttu-id="e9265-123">コマンド ' CREATE USER [app name] を EXTERNAL PROVIDER から実行して、新しいユーザーを作成します。</span><span class="sxs-lookup"><span data-stu-id="e9265-123">Create a new user by running the command ‘CREATE USER [app name] FROM EXTERNAL PROVIDER’</span></span>
 - <span data-ttu-id="e9265-124">コマンド ' exec sp_addrolemember ' db_datareader '、[app name] '、または ' ALTER ROLE db_datareader ADD MEMBER [app name] ' を実行して、ユーザーを役割に追加します。</span><span class="sxs-lookup"><span data-stu-id="e9265-124">Add user to role by running command 'exec sp_addrolemember 'db_datareader', [app name]' Or 'ALTER ROLE db_datareader ADD MEMBER [app name]'</span></span>

>[!NOTE]
><span data-ttu-id="e9265-125">Azure Active Directory に登録されているすべてのアプリへのアクセスを取り消すには、[登録済みアプリの削除](https://docs.microsoft.com/azure/active-directory/develop/quickstart-remove-app)に関する azure のドキュメントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e9265-125">To revoke access to any app registered in Azure Active Directory, refer the Azure documentation on [removing a registered app](https://docs.microsoft.com/azure/active-directory/develop/quickstart-remove-app).</span></span>

## <a name="connect-to-a-data-source"></a><span data-ttu-id="e9265-126">データソースへの接続</span><span class="sxs-lookup"><span data-stu-id="e9265-126">Connect to a data source</span></span>
<span data-ttu-id="e9265-127">Microsoft SQL server コネクタをデータソースに接続するには、クロールするデータベースサーバーとオンプレミスゲートウェイを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-127">To connect your Microsoft SQL server connector to a data source, you must configure the database server you want crawled and the on-premises gateway.</span></span> <span data-ttu-id="e9265-128">その後、必要な認証方法を使用してデータベースに接続できます。</span><span class="sxs-lookup"><span data-stu-id="e9265-128">You can then connect to the database with the required authentication method.</span></span>

<span data-ttu-id="e9265-129">Azure SQL コネクタの場合は、接続先のサーバー名または IP アドレスのみを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-129">For the Azure SQL connector, you only need to specify the server name or IP address you want to connect to.</span></span> <span data-ttu-id="e9265-130">Azure SQL コネクタは、データベースに接続するための Azure Active Directory Open ID connect (OIDC) 認証のみをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="e9265-130">Azure SQL connector only supports Azure Active Directory Open ID connect (OIDC) authentication to connect to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="e9265-131">データベースで接続するには、Microsoft SQL server connector の SQL server バージョン2008以降を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-131">Your database must run SQL server version 2008 or later for the Microsoft SQL server connector to be able to connect.</span></span>

<span data-ttu-id="e9265-132">データベースコンテンツを検索するには、コネクタを構成するときに SQL クエリを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-132">To search your database content, you must specify SQL queries when you configure the connector.</span></span> <span data-ttu-id="e9265-133">これらの SQL クエリは、すべての列を取得するために実行する必要があるすべての SQL 結合を含む、インデックスを作成するすべてのデータベース列に名前を付ける必要があります (つまり、ソースプロパティ)。</span><span class="sxs-lookup"><span data-stu-id="e9265-133">These SQL queries need to name all the database columns that you want to index (i.e. source properties), including any SQL joins that need to be performed to get all the columns.</span></span> <span data-ttu-id="e9265-134">検索結果へのアクセスを制限するには、コネクタを構成するときに SQL クエリ内でアクセス制御リスト (Acl) を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-134">To restrict access to search results, you must specify Access Control Lists (ACLs) within SQL queries when you configure the connector.</span></span>

## <a name="full-crawl-required"></a><span data-ttu-id="e9265-135">フルクロール (必須)</span><span class="sxs-lookup"><span data-stu-id="e9265-135">Full crawl (Required)</span></span>
<span data-ttu-id="e9265-136">この手順では、データベースのフルクロールを実行する SQL クエリを構成します。</span><span class="sxs-lookup"><span data-stu-id="e9265-136">In this step, you configure the SQL query that runs a full crawl of the database.</span></span> <span data-ttu-id="e9265-137">フルクロールでは、**クエリ**可能、**検索**可能、または取得可能にするすべての列またはプロパティが選択**されます。**</span><span class="sxs-lookup"><span data-stu-id="e9265-137">The full crawl selects all the columns or properties you want to be made **queryable**, **searchable**, or **retrievable**.</span></span> <span data-ttu-id="e9265-138">また、ACL 列を指定して、検索結果のアクセスを特定のユーザーまたはグループに制限することもできます。</span><span class="sxs-lookup"><span data-stu-id="e9265-138">You can also specify ACL columns to restrict access of search results to specific users or groups.</span></span>

> [!Tip]
> <span data-ttu-id="e9265-139">必要なすべての列を取得するには、複数のテーブルに結合することができます。</span><span class="sxs-lookup"><span data-stu-id="e9265-139">To get all the columns that you need, you can join multiple tables.</span></span>

![プロパティの例を使用して、OrderTable と AclTable を示すスクリプト](media/MSSQL-fullcrawl.png)

### <a name="select-data-columns-required-and-acl-columns-optional"></a><span data-ttu-id="e9265-141">データ列の選択 (必須) と ACL 列 (省略可能)</span><span class="sxs-lookup"><span data-stu-id="e9265-141">Select data columns (Required) and ACL columns (Optional)</span></span>
<span data-ttu-id="e9265-142">この例では、検索のデータを保持する5つのデータ列 (OrderId、OrderTitle、Ordertitle、Htmldatetime、および IsDeleted) の選択例を示します。</span><span class="sxs-lookup"><span data-stu-id="e9265-142">The example demonstrates selection of five data columns that hold the data for the search: OrderId, OrderTitle, OrderDesc, CreatedDateTime, and IsDeleted.</span></span> <span data-ttu-id="e9265-143">データの各行に対して表示権限を設定するには、必要に応じて、次の ACL 列を選択できます。 AllowedUsers、Allowedusers、DeniedUsers、および DeniedGroups。</span><span class="sxs-lookup"><span data-stu-id="e9265-143">To set view permissions for each row of data, you can optionally select these ACL columns: AllowedUsers, AllowedGroups, DeniedUsers, and DeniedGroups.</span></span> <span data-ttu-id="e9265-144">これらのすべてのデータ列は、**クエリ**可能、**検索**可能 **、または**取得可能にすることができます。</span><span class="sxs-lookup"><span data-stu-id="e9265-144">All these data columns can be made **queryable**, **searchable**, or **retrievable**.</span></span>

<span data-ttu-id="e9265-145">次のクエリ例に示すように、データ列を選択します。`SELECT OrderId, OrderTitle, OrderDesc, AllowedUsers, AllowedGroups, DeniedUsers, DeniedGroups, CreatedDateTime, IsDeleted`</span><span class="sxs-lookup"><span data-stu-id="e9265-145">Select data columns as shown in this example query: `SELECT OrderId, OrderTitle, OrderDesc, AllowedUsers, AllowedGroups, DeniedUsers, DeniedGroups, CreatedDateTime, IsDeleted`</span></span>
 
<span data-ttu-id="e9265-146">検索結果へのアクセスを管理するには、クエリで1つ以上の ACL 列を指定できます。</span><span class="sxs-lookup"><span data-stu-id="e9265-146">To manage access to the search results, you can specify one or more ACL columns in the query.</span></span> <span data-ttu-id="e9265-147">SQL コネクタを使用すると、レコードレベルごとにアクセスを制御できます。</span><span class="sxs-lookup"><span data-stu-id="e9265-147">The SQL connector allows you to control access at per record level.</span></span> <span data-ttu-id="e9265-148">テーブル内のすべてのレコードに対して同じアクセス制御を行うことを選択できます。</span><span class="sxs-lookup"><span data-stu-id="e9265-148">You can choose to have the same access control for all records in a table.</span></span> <span data-ttu-id="e9265-149">ACL 情報が別のテーブルに格納されている場合は、クエリでそれらのテーブルを使用して結合する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-149">If the ACL information is stored in a separate table, you might have to do a join with those tables in your query.</span></span>

<span data-ttu-id="e9265-150">以下では、上記のクエリで各 ACL 列を使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e9265-150">The use of each of the ACL columns in the above query is described below.</span></span> <span data-ttu-id="e9265-151">次のリストでは、4つの**アクセス制御メカニズム**について説明します。</span><span class="sxs-lookup"><span data-stu-id="e9265-151">The following list explains the 4 **access control mechanisms**.</span></span> 
* <span data-ttu-id="e9265-152">**Allowedusers**: これにより、検索結果にアクセスできるユーザー id のリストを指定します。</span><span class="sxs-lookup"><span data-stu-id="e9265-152">**AllowedUsers**: This specifies the list of user IDs who will be able to access the search results.</span></span> <span data-ttu-id="e9265-153">次の例では、ユーザーのリスト: john@contoso.com、keith@contoso.com、および lisa@contoso.com には、OrderId = 12 のレコードへのアクセスのみが許可されています。</span><span class="sxs-lookup"><span data-stu-id="e9265-153">In the following example, list of users: john@contoso.com, keith@contoso.com, and lisa@contoso.com would only have access to a record with OrderId = 12.</span></span> 
* <span data-ttu-id="e9265-154">**Allowedgroups**: これにより、検索結果にアクセスできるユーザーのグループが指定されます。</span><span class="sxs-lookup"><span data-stu-id="e9265-154">**AllowedGroups**: This specifies the group of users who will be able to access the search results.</span></span> <span data-ttu-id="e9265-155">次の例では、グループ sales-team@contoso.com は OrderId = 12 のレコードにのみアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="e9265-155">In the following example, group sales-team@contoso.com would only have access to record with OrderId = 12.</span></span>
* <span data-ttu-id="e9265-156">**DeniedUsers**: 検索結果への**アクセス権を持たない**ユーザーのリストを指定します。</span><span class="sxs-lookup"><span data-stu-id="e9265-156">**DeniedUsers**: This specifies the list of users who do **not** have access to the search results.</span></span> <span data-ttu-id="e9265-157">次の例では、ユーザー john@contoso.com および keith@contoso.com は OrderId = 13 のレコードにアクセスできませんが、他のすべてのユーザーはこのレコードにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="e9265-157">In the following example, users john@contoso.com and keith@contoso.com do not have access to record with OrderId = 13, whereas everyone else has access to this record.</span></span> 
* <span data-ttu-id="e9265-158">**DeniedGroups**: 検索結果への**アクセス権を持たない**ユーザーのグループを指定します。</span><span class="sxs-lookup"><span data-stu-id="e9265-158">**DeniedGroups**: This specifies the group of users who do **not** have access to the search results.</span></span> <span data-ttu-id="e9265-159">次の例では、groups engg-team@contoso.com および pm-team@contoso.com には OrderId = 15 のレコードへのアクセス権がありませんが、他のユーザーはこのレコードにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="e9265-159">In the following example, groups engg-team@contoso.com and pm-team@contoso.com do not have access to record with OrderId = 15, whereas everyone else has access to this record.</span></span>  

![プロパティの例を使用して、OrderTable と AclTable を表示するサンプルデータ](media/MSSQL-ACL1.png)

### <a name="supported-data-types"></a><span data-ttu-id="e9265-161">サポートされるデータ型</span><span class="sxs-lookup"><span data-stu-id="e9265-161">Supported data types</span></span>
<span data-ttu-id="e9265-162">次の表は、MS SQL および Azure SQL コネクタでサポートされている SQL データ型の概要を示しています。</span><span class="sxs-lookup"><span data-stu-id="e9265-162">The below table summarizes the SQL data types that are supported in the MS SQL and Azure SQL connectors.</span></span> <span data-ttu-id="e9265-163">また、サポートされている SQL データ型のインデックスデータ型の概要を示します。</span><span class="sxs-lookup"><span data-stu-id="e9265-163">The table also summarizes the indexing data type for the supported SQL data type.</span></span> <span data-ttu-id="e9265-164">インデックス用にサポートされている Microsoft Graph コネクタの詳細については、「[プロパティリソースの種類](https://docs.microsoft.com/graph/api/resources/property?view=graph-rest-beta#properties)に関するドキュメント」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e9265-164">To learn more about Microsoft Graph connectors supported data types for indexing, refer documentation on [property resource types](https://docs.microsoft.com/graph/api/resources/property?view=graph-rest-beta#properties).</span></span> 

| <span data-ttu-id="e9265-165">カテゴリ</span><span class="sxs-lookup"><span data-stu-id="e9265-165">Category</span></span> | <span data-ttu-id="e9265-166">ソースデータ型</span><span class="sxs-lookup"><span data-stu-id="e9265-166">Source data type</span></span> | <span data-ttu-id="e9265-167">インデックス作成データの種類</span><span class="sxs-lookup"><span data-stu-id="e9265-167">Indexing data type</span></span> |
| ------------ | ------------ | ------------ |
| <span data-ttu-id="e9265-168">日時</span><span class="sxs-lookup"><span data-stu-id="e9265-168">Date and time</span></span> | <span data-ttu-id="e9265-169">date</span><span class="sxs-lookup"><span data-stu-id="e9265-169">date</span></span> <br> <span data-ttu-id="e9265-170">日付型</span><span class="sxs-lookup"><span data-stu-id="e9265-170">datetime</span></span> <br> <span data-ttu-id="e9265-171">datetime2</span><span class="sxs-lookup"><span data-stu-id="e9265-171">datetime2</span></span> <br> <span data-ttu-id="e9265-172">smalldatetime</span><span class="sxs-lookup"><span data-stu-id="e9265-172">smalldatetime</span></span> | <span data-ttu-id="e9265-173">日付型</span><span class="sxs-lookup"><span data-stu-id="e9265-173">datetime</span></span> |
| <span data-ttu-id="e9265-174">真数</span><span class="sxs-lookup"><span data-stu-id="e9265-174">Exact numeric</span></span> | <span data-ttu-id="e9265-175">bigint</span><span class="sxs-lookup"><span data-stu-id="e9265-175">bigint</span></span> <br> <span data-ttu-id="e9265-176">int</span><span class="sxs-lookup"><span data-stu-id="e9265-176">int</span></span> <br> <span data-ttu-id="e9265-177">smallint</span><span class="sxs-lookup"><span data-stu-id="e9265-177">smallint</span></span> <br> <span data-ttu-id="e9265-178">tinyint</span><span class="sxs-lookup"><span data-stu-id="e9265-178">tinyint</span></span> | <span data-ttu-id="e9265-179">int64</span><span class="sxs-lookup"><span data-stu-id="e9265-179">int64</span></span> |
| <span data-ttu-id="e9265-180">真数</span><span class="sxs-lookup"><span data-stu-id="e9265-180">Exact numeric</span></span> | <span data-ttu-id="e9265-181">若干</span><span class="sxs-lookup"><span data-stu-id="e9265-181">bit</span></span> | <span data-ttu-id="e9265-182">ブール値</span><span class="sxs-lookup"><span data-stu-id="e9265-182">boolean</span></span> |
| <span data-ttu-id="e9265-183">近似数値</span><span class="sxs-lookup"><span data-stu-id="e9265-183">Approximate numeric</span></span> | <span data-ttu-id="e9265-184">浮動小数点数</span><span class="sxs-lookup"><span data-stu-id="e9265-184">float</span></span> <br> <span data-ttu-id="e9265-185">本当の</span><span class="sxs-lookup"><span data-stu-id="e9265-185">real</span></span> | <span data-ttu-id="e9265-186">double</span><span class="sxs-lookup"><span data-stu-id="e9265-186">double</span></span> |
| <span data-ttu-id="e9265-187">文字の文字列</span><span class="sxs-lookup"><span data-stu-id="e9265-187">Character string</span></span> | <span data-ttu-id="e9265-188">カーソル</span><span class="sxs-lookup"><span data-stu-id="e9265-188">char</span></span> <br> <span data-ttu-id="e9265-189">varchar</span><span class="sxs-lookup"><span data-stu-id="e9265-189">varchar</span></span> <br> <span data-ttu-id="e9265-190">text</span><span class="sxs-lookup"><span data-stu-id="e9265-190">text</span></span> | <span data-ttu-id="e9265-191">string</span><span class="sxs-lookup"><span data-stu-id="e9265-191">string</span></span> |
| <span data-ttu-id="e9265-192">Unicode 文字列</span><span class="sxs-lookup"><span data-stu-id="e9265-192">Unicode character strings</span></span> | <span data-ttu-id="e9265-193">nchar</span><span class="sxs-lookup"><span data-stu-id="e9265-193">nchar</span></span> <br> <span data-ttu-id="e9265-194">nvarchar</span><span class="sxs-lookup"><span data-stu-id="e9265-194">nvarchar</span></span> <br> <span data-ttu-id="e9265-195">型</span><span class="sxs-lookup"><span data-stu-id="e9265-195">ntext</span></span> | <span data-ttu-id="e9265-196">string</span><span class="sxs-lookup"><span data-stu-id="e9265-196">string</span></span> |
| <span data-ttu-id="e9265-197">その他のデータ型</span><span class="sxs-lookup"><span data-stu-id="e9265-197">Other data types</span></span> | <span data-ttu-id="e9265-198">識別子</span><span class="sxs-lookup"><span data-stu-id="e9265-198">uniqueidentifier</span></span> | <span data-ttu-id="e9265-199">string</span><span class="sxs-lookup"><span data-stu-id="e9265-199">string</span></span> |

<span data-ttu-id="e9265-200">現在直接サポートされていないその他のデータ型については、列は、サポートされているデータ型に明示的にキャストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-200">For any other data type currently not directly supported, the column needs to be explicitly cast to a supported data type.</span></span>

### <a name="watermark-required"></a><span data-ttu-id="e9265-201">ウォーターマーク (必須)</span><span class="sxs-lookup"><span data-stu-id="e9265-201">Watermark (Required)</span></span>
<span data-ttu-id="e9265-202">データベースが過負荷にならないようにするために、コネクタはフルクロールのウォーターマーク列を使用して、フルクロールクエリをバッチ処理および再開します。</span><span class="sxs-lookup"><span data-stu-id="e9265-202">To prevent overloading the database, the connector batches and resumes full-crawl queries with a full-crawl watermark column.</span></span> <span data-ttu-id="e9265-203">[すかし] 列の値を使用すると、以降の各バッチが取得され、最後のチェックポイントからクエリが再開されます。</span><span class="sxs-lookup"><span data-stu-id="e9265-203">By using the value of the watermark column, each subsequent batch is fetched, and querying is resumed from the last checkpoint.</span></span> <span data-ttu-id="e9265-204">基本的には、フルクロールのデータ更新を制御するメカニズムを示します。</span><span class="sxs-lookup"><span data-stu-id="e9265-204">Essentially this is a mechanism to control data refresh for full crawls.</span></span>

<span data-ttu-id="e9265-205">次の例に示すように、ウォーターマークに対してクエリスニペットを作成します。</span><span class="sxs-lookup"><span data-stu-id="e9265-205">Create query snippets for watermarks as shown in these examples:</span></span>
* <span data-ttu-id="e9265-206">`WHERE (CreatedDateTime > @watermark)`.</span><span class="sxs-lookup"><span data-stu-id="e9265-206">`WHERE (CreatedDateTime > @watermark)`.</span></span> <span data-ttu-id="e9265-207">予約済みのキーワードを使用して、ウォーターマーク列名を指定し `@watermark` ます。</span><span class="sxs-lookup"><span data-stu-id="e9265-207">Cite the watermark column name with the reserved keyword `@watermark`.</span></span> <span data-ttu-id="e9265-208">[すかし] 列の並べ替え順序が昇順の場合は、を使用 `>` します。それ以外の場合は、を使用 `<` します。</span><span class="sxs-lookup"><span data-stu-id="e9265-208">If the sort order of the watermark column is ascending, use `>`; otherwise, use `<`.</span></span>
* <span data-ttu-id="e9265-209">`ORDER BY CreatedDateTime ASC`.</span><span class="sxs-lookup"><span data-stu-id="e9265-209">`ORDER BY CreatedDateTime ASC`.</span></span> <span data-ttu-id="e9265-210">[すかし] 列の昇順または降順に並べ替えます。</span><span class="sxs-lookup"><span data-stu-id="e9265-210">Sort on the watermark column in ascending or descending order.</span></span>

<span data-ttu-id="e9265-211">次の図に示す構成では、[ `CreatedDateTime` 選択されたウォーターマーク] 列が選択されています。</span><span class="sxs-lookup"><span data-stu-id="e9265-211">In the configuration shown in the following image, `CreatedDateTime` is the selected watermark column.</span></span> <span data-ttu-id="e9265-212">行の最初のバッチをフェッチするには、[すかし] 列のデータ型を指定します。</span><span class="sxs-lookup"><span data-stu-id="e9265-212">To fetch the first batch of rows, specify the data type of the watermark column.</span></span> <span data-ttu-id="e9265-213">この例では、データ型は `DateTime` です。</span><span class="sxs-lookup"><span data-stu-id="e9265-213">In this case, the data type is `DateTime`.</span></span>

![ウォーターマーク列の構成](media/MSSQL-watermark.png)

<span data-ttu-id="e9265-215">最初のクエリは、次の値を使用して、最初の**N 個**の行をフェッチします。 "/1 月1日 > 1753 00:00:00" (datetime データ型の最小値)。</span><span class="sxs-lookup"><span data-stu-id="e9265-215">The first query fetches the first **N** number of rows by using: "CreatedDateTime > January 1, 1753 00:00:00" (min value of DateTime data type).</span></span> <span data-ttu-id="e9265-216">最初のバッチをフェッチした後、 `CreatedDateTime` バッチで返される最大値は、行が昇順で並べ替えられている場合に、チェックポイントとして保存されます。</span><span class="sxs-lookup"><span data-stu-id="e9265-216">After the first batch is fetched, the highest value of `CreatedDateTime` returned in the batch is saved as the checkpoint if the rows are sorted in ascending order.</span></span> <span data-ttu-id="e9265-217">例としては、2019年3月1日、03:00:00 があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-217">An example is March 1, 2019 03:00:00.</span></span> <span data-ttu-id="e9265-218">その後、 **N**行の次のバッチは、クエリ内の "/datetime > 03:00:00 2019 年3月1日を使用してフェッチされます。</span><span class="sxs-lookup"><span data-stu-id="e9265-218">Then the next batch of **N** rows is fetched by using "CreatedDateTime > March 1, 2019 03:00:00" in the query.</span></span>

### <a name="skipping-soft-deleted-rows-optional"></a><span data-ttu-id="e9265-219">削除された削除済みの行をスキップする (オプション)</span><span class="sxs-lookup"><span data-stu-id="e9265-219">Skipping soft-deleted rows (Optional)</span></span>
<span data-ttu-id="e9265-220">データベース内の削除済みの行をインデックス作成から除外するには、その行が削除されたことを示す、回復可能な削除の列名と値を指定します。</span><span class="sxs-lookup"><span data-stu-id="e9265-220">To exclude soft-deleted rows in your database from being indexed, specify the soft-delete column name and value that indicates the row is deleted.</span></span>

![論理削除の設定: "削除済みの行を示す" 論理削除列 "および" 値 (論理削除列) "](media/MSSQL-softdelete.png)

### <a name="full-crawl-manage-search-permissions"></a><span data-ttu-id="e9265-222">フルクロール: 検索権限を管理する</span><span class="sxs-lookup"><span data-stu-id="e9265-222">Full crawl: Manage search permissions</span></span>
<span data-ttu-id="e9265-223">[アクセス**許可の管理**] をクリックして、アクセス制御メカニズムを指定するさまざまなアクセス制御 (ACL) 列を選択します。</span><span class="sxs-lookup"><span data-stu-id="e9265-223">Click **Manage permissions** to select the various access control (ACL) columns which specify the access control mechanism.</span></span> <span data-ttu-id="e9265-224">フルクロール SQL クエリで指定した列名を選択します。</span><span class="sxs-lookup"><span data-stu-id="e9265-224">Select the column name you specified in the full crawl SQL query.</span></span> 

<span data-ttu-id="e9265-225">各 ACL 列は複数値の列になることが想定されています。</span><span class="sxs-lookup"><span data-stu-id="e9265-225">Each of the ACL columns is expected to be a multi-valued column.</span></span> <span data-ttu-id="e9265-226">これらの複数の ID 値は、セミコロン (;)、コンマ (,) などの区切り記号で区切ることができます。</span><span class="sxs-lookup"><span data-stu-id="e9265-226">These multiple ID values can be separated by separators such as semicolon (;), comma (,), and so on.</span></span> <span data-ttu-id="e9265-227">この区切り記号は、[値の**区切り記号**] フィールドで指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-227">You need to specify this separator in the **value separator** field.</span></span>
 
<span data-ttu-id="e9265-228">Acl としてを使用するために、次の ID タイプがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="e9265-228">The following ID types are supported for using as ACLs:</span></span> 
* <span data-ttu-id="e9265-229">**ユーザープリンシパル名 (upn)**: ユーザープリンシパル名 (upn) は、電子メールアドレス形式のシステムユーザーの名前です。</span><span class="sxs-lookup"><span data-stu-id="e9265-229">**User Principal Name (UPN)**: A User Principal Name (UPN) is the name of a system user in an email address format.</span></span> <span data-ttu-id="e9265-230">UPN (例: john.doe@domain.com) は、ユーザー名 (ログオン名)、区切り記号 (@ 記号)、およびドメイン名 (UPN サフィックス) で構成されます。</span><span class="sxs-lookup"><span data-stu-id="e9265-230">A UPN (for example: john.doe@domain.com) consists of the username (logon name), separator (the @ symbol), and domain name (UPN suffix).</span></span> 
* <span data-ttu-id="e9265-231">**Azure Active Directory (AAD) ID**: azure AD では、すべてのユーザーまたはグループのオブジェクト ID が ' e0d3ad3d-0000-1111-2222-3c5f5c52ab9b ' のようになります。</span><span class="sxs-lookup"><span data-stu-id="e9265-231">**Azure Active Directory (AAD) ID**: In Azure AD, every user or group has an object ID which looks something like ‘e0d3ad3d-0000-1111-2222-3c5f5c52ab9b’</span></span> 
* <span data-ttu-id="e9265-232">**Active Directory (AD) セキュリティ ID**: オンプレミスの AD セットアップでは、すべてのユーザーとグループに、1-5-21-3878594291-2115959936-132693609-65242 というような不変の一意のセキュリティ識別子があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-232">**Active Directory (AD) Security ID**: In an on-premises AD setup, every user and group have an immutable, unique security identifier which looks something like ‘S-1-5-21-3878594291-2115959936-132693609-65242.’</span></span>

![アクセス制御リストを構成するための検索アクセス許可の設定](media/MSSQL-ACL2.png)

## <a name="incremental-crawl-optional"></a><span data-ttu-id="e9265-234">増分クロール (オプション)</span><span class="sxs-lookup"><span data-stu-id="e9265-234">Incremental crawl (Optional)</span></span>
<span data-ttu-id="e9265-235">このオプションの手順では、データベースの増分クロールを実行するための SQL クエリを指定します。</span><span class="sxs-lookup"><span data-stu-id="e9265-235">In this optional step, provide a SQL query to run an incremental crawl of the database.</span></span> <span data-ttu-id="e9265-236">このクエリでは、最後の増分クロール以降のデータの変更が SQL コネクタによって決定されます。</span><span class="sxs-lookup"><span data-stu-id="e9265-236">With this query, the SQL connector determines any changes to the data since the last incremental crawl.</span></span> <span data-ttu-id="e9265-237">フルクロールの場合と同様に、**クエリ**可能、**検索**可能、または取得可能にするすべての列を**選択します**。</span><span class="sxs-lookup"><span data-stu-id="e9265-237">As in the full crawl, select all columns that you want to be made **queryable**, **searchable**, or **retrievable**.</span></span> <span data-ttu-id="e9265-238">フルクロールクエリで指定したものと同じ ACL 列のセットを指定します。</span><span class="sxs-lookup"><span data-stu-id="e9265-238">Specify the same set of ACL columns that you specified in the full crawl query.</span></span>

<span data-ttu-id="e9265-239">次の図のコンポーネントは、完全なクロールコンポーネントに似ていますが、1つの例外があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-239">The components in the following image resemble the full crawl components with one exception.</span></span> <span data-ttu-id="e9265-240">この例では、"ModifiedDateTime" は選択された透かし列です。</span><span class="sxs-lookup"><span data-stu-id="e9265-240">In this case, "ModifiedDateTime" is the selected watermark column.</span></span> <span data-ttu-id="e9265-241">[フルクロールの手順](#full-crawl-required)を確認して、増分クロールクエリを記述する方法を説明し、次の画像を例として示します。</span><span class="sxs-lookup"><span data-stu-id="e9265-241">Review the [full crawl steps](#full-crawl-required) to learn how to write your incremental crawl query and see the following image as an example.</span></span>

![OrderTable、AclTable、使用できるプロパティの例を示す増分クロールスクリプト。](media/MSSQL-incrcrawl.png)

## <a name="manage-search-permissions"></a><span data-ttu-id="e9265-243">検索アクセス許可を管理する</span><span class="sxs-lookup"><span data-stu-id="e9265-243">Manage search permissions</span></span> 
<span data-ttu-id="e9265-244">[フルクロール画面で指定された acl](#full-crawl-manage-search-permissions)を使用するか、すべてのユーザーにコンテンツを表示するように上書きするかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="e9265-244">You can choose to use the [ACLs specified in the full crawl screen](#full-crawl-manage-search-permissions) or you can override them to make your content visible to everyone.</span></span>

## <a name="limitations"></a><span data-ttu-id="e9265-245">制限事項</span><span class="sxs-lookup"><span data-stu-id="e9265-245">Limitations</span></span>
<span data-ttu-id="e9265-246">SQL コネクタには、次のようなプレビューリリースの制限があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-246">The SQL connectors have these limitations in the preview release:</span></span>
* <span data-ttu-id="e9265-247">Microsoft SQL server connector: オンプレミスのデータベースは、SQL server バージョン2008以降を実行している必要があります。</span><span class="sxs-lookup"><span data-stu-id="e9265-247">Microsoft SQL server connector: The on-premises database must run SQL server version 2008 or later.</span></span>
* <span data-ttu-id="e9265-248">Acl は、ユーザープリンシパル名 (UPN)、Azure Active Directory (Azure AD)、または Active Directory セキュリティを使用する場合にのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="e9265-248">ACLs are only supported by using a User Principal Name (UPN), Azure Active Directory (Azure AD), or Active Directory Security.</span></span> 
* <span data-ttu-id="e9265-249">データベース列内のリッチコンテンツのインデックス作成はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="e9265-249">Indexing rich content inside database columns is not supported.</span></span> <span data-ttu-id="e9265-250">このようなコンテンツの例としては、HTML、JSON、XML、blob、ドキュメント parsings などがあります。これらは、データベース列内のリンクとして存在します。</span><span class="sxs-lookup"><span data-stu-id="e9265-250">Examples of such content are HTML, JSON, XML, blobs, and document parsings that exist as links inside the database columns.</span></span>
